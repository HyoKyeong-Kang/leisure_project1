<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.css" rel="stylesheet">
</head>
<body>
   	<span>출석체크 하기!</span>
   	  <img src="/img/stamp2.png" id="stamp2" alt="로고 이미지">
    <div id="calendar">
    </div>

    <!-- FullCalendar JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        calendarEl.style.width = '1200px';
        calendarEl.style.marginLeft = '500px';
        calendarEl.style.marginTop = '200px';

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            contentHeight: 600,

            events: [
                // 이벤트 데이터를 여기에 추가할 수 있습니다.
            ],
            dayCellDidMount: function(info) {
                var cellEl = info.el;
                cellEl.addEventListener('click', function() {
                    var confirmAttendance = confirm('출석체크 하시겠습니까?');
                    if (confirmAttendance) {
                        var stampImage = document.createElement('img');
                        stampImage.src = '/img/stamp.jpg';
                        stampImage.classList.add('stamp-image'); // 이미지에 클래스 추가
                        cellEl.appendChild(stampImage);
                    }
                });

                cellEl.style.cursor = 'pointer';
                cellEl.style.position = 'relative'; // 상대적 위치 설정
            },
            dayCellUnmounted: function(info) {
                var cellEl = info.el;
                var stampImage = cellEl.querySelector('.stamp-image');
                if (stampImage) {
                    stampImage.remove();
                }
                cellEl.style.cursor = '';
            }
        });

        calendar.render();

        // 이미지 클릭할 때의 이벤트 핸들러를 추가합니다.
        var stampImage2 = document.getElementById('stamp2');
        stampImage2.addEventListener('click', function() {
            var today = new Date();
            var dateString = today.toISOString().substr(0, 10); // 날짜 형식 변환
            var targetCell = document.querySelector(`td[data-date="${dateString}"]`);

            if (targetCell) {
                var existingStamp = targetCell.querySelector('.stamp-image');
                if (!existingStamp) {
                    var newStampImage = document.createElement('img');
                    newStampImage.src = '/img/stamp.jpg';
                    newStampImage.classList.add('stamp-image');
                    targetCell.appendChild(newStampImage);
                }
            }
        });
    });
    </script>
    <script>
    
    stampImage2.addEventListener('click', function() {
        var today = new Date();
        var dateString = today.toISOString().substr(0, 10); // 날짜 형식 변환
        var targetCell = document.querySelector(`td[data-date="${dateString}"]`);

        if (targetCell) {
            var existingStamp = targetCell.querySelector('.stamp-image');
            if (!existingStamp) {
                var newStampImage = document.createElement('img');
                newStampImage.src = '/img/stamp2.png';
                newStampImage.classList.add('stamp-image');
                targetCell.appendChild(newStampImage);
                
                // 이미지 클릭 시 포인트 업데이트 및 저장
                fetch('/update-point', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pointAmount: 10 // 포인트 증가량
                    })
                });
            }
        }
    });
    
    </script>
</body>
<style>
.stamp-image {
    position: absolute;
    top: 50%; /* 이미지의 상단을 칸의 중앙에 위치시킴 */
    left: 50%; /* 이미지의 왼쪽을 칸의 중앙에 위치시킴 */
    transform: translate(-50%, -50%); /* 이미지를 중앙 정렬 */
    max-width: 70%; /* 이미지의 최대 너비를 칸의 절반으로 제한 */
    max-height: 70%; /* 이미지의 최대 높이를 칸의 절반으로 제한 */
    object-fit: contain; /* 이미지를 확대/축소하여 전체가 보이도록 설정 */
}

/* 일자별 칸 스타일 설정 */
.fc-daygrid-day {
    height: 80px; /* 일자별 칸 높이 설정 */
}
#stamp2{
width: 100px; 
height: auto;
position: absolute;
bottom: 800px;
left:620px;
cursor: pointer;

}
</style>
</html>